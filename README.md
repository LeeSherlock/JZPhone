# JZPhone
怎样将Linphone移植到自己的项目





云之讯国信电话SDK
iOS版使用说明书


























深圳市云之讯网络技术有限公司


版权与免责声明

版权所有 深圳市云之讯网络技术有限公司 2015。 保留一切权利。
非经本公司许可，任何单位和个人不得擅自摘抄、复制本文档内容的部分或全部，并不得以任何形式传播。

本文档内容不定期更新，请用户随时关注官网的更新信息，进行正确操作。云之讯不对因为使用不当，或者人为损坏此文件的直接、 间接、特殊、附带的行为或者由之产生的损失（包括但不限于经济损失，个人损失，财产及精神损失）承担责任。








深圳市云之讯网络技术有限公司
地址：		深圳市南山区科技园高新南四道8号创维半导体设计大厦东座19楼
网址：		http://www.ucpaas.com/
技术支持：	400-097-0020
合作邮箱：	service@ucpaas.com


目录
1	集成VideoSDK前的准备工作	1
1.1	注册云之讯开发者账号	1
2	下载SDK	1
3	SDK目录讲解	1
4	配置工程	1
4.1	环境要求	1
4.2	创建工程	1
4.3	导入SDK头文件	3
4.4	导入SDK静态库	4
4.5	配置工程信息	5
5	功能实现	8
5.1	SDK初始化	8
5.2	配置登陆信息	9
5.3	拨打电话	11
5.4	接听/挂断电话	11
5.5	相关回调	12
5.6	其他功能	13
6	编译运行及工程打包	13
6.1	编译	13
6.2	查看工程日志	14
6.3	工程打包	14




前 言
在您阅读此文档时，我们假定您已经具备了基础的iOS应用开发经验，并能够理解相关基础概念。
在讲解VideoSDK的集成过程中，我们会以 云之讯Demo 为例进行讲解。云之讯Demo是VideoSDK和IMSDK的集成示例demo，开发者可以参考demo的集成用法，我们也鼓励开发者根据自己的需求进行调整。


云之讯Video SDK为开发者提供基础的Video通讯能力，开发者使用SDK快速接入通讯能力。云之讯Demo是VideoSDK与IMSDK的示例Demo, 我们强烈建议开发者在使用VideoSDK之前，先体验云之讯Demo。


1	集成VideoSDK前的准备工作
1.1	注册云之讯开发者账号
成为云之讯平台开发者，并创建后台应用，详细步骤见注册云之讯开发者账号和管理中心使用指南。如果你已经是平台开发者，并且对云之讯平台非常熟悉，那么你可以跳过这一步继续往下看。

2	下载SDK
在这里你需要下载VideoSDK 和 TCPSDK。

3	SDK目录讲解
包含两部分：ucsipccsdk。
libucsipccsdk.a 整个ucsipccsdk的库文件
UCSIPCCManager.h 为应用调用的函数头文件
UCSIPCCDelegate.h 为SDK的代理函数头文件
UCSIPCCClass.h 为SDK声明相应的实体

4	配置工程
这一节是为了让开发者能够用正确的导入sdk文件，以及正确配置工程信息。
4.1	环境要求
Mac OS X 10.7 (Lion)及以上版本; XCode4.2及以上版本。
4.2	创建工程
创建一个iPhone工程需要在Mac系统下面安装Xcode的软件，Xcode安装完成后可以在桌面的快速启动栏中的"Launchpad"中或者应用程序中找到一个图标看到后单击或者双击即可打开软件，Xcode版本最小需要4.2。
打开Xcode后的界面可以看到几个选项，创建工程需要选择"Create a new Xcode project",如下图所示：

也可以根据菜单创建工程，依次选择XCode菜单栏中的FiLe->New->Project，如下图所示：

选择完后弹出的界面中选择左边的"iOS"下面的"Application",然后选择右边的"Single View AppLication"进行双击或者点击右下角"Next", 如下图所示：

在完成后弹出的界面中的"ProductName"中填写你的工程名，如下图所示:

添加完成后点击右下角的”Next”，在弹出的对话框中选择你需要把工程放置的位置。这样一个工程就初步的创建完成。

4.3	导入SDK头文件
创建完成工程后，把刚才下载的SDK包里面的ucsipccsdk文件夹拷贝到新创建的工程路径下面，然后在工程目录结构中，右键选择Add Files to “云之讯Demo” (工程名称，在弹出的对话框中选择新创建的工程文件夹下的sdk这个文件夹，即前面拷贝的文件夹)。或者将这个文件夹拖入XCode 工程目录结构中，(注：此过程暂时不需要添加.a库，只需要添加.h的头文件)

在弹出的界面中勾选Copy items into destination group’s folder(ifneeded),并确保Add To Targets勾选相应的target。 相应的操作请看下图中所示：

4.4	导入SDK静态库
添加步骤:展开LinkBinary With Libraries后点击展开后下面的"+"来添加下面的依赖项,
如图所示:



点击Add Other 后，找到libucsipccsdk.a存放的地方（注：建议事先将sdk的库文件和头文件放入工程的文件夹中，避免被删除后导致无法引用）
4.5	配置工程信息
υ	添加依赖框架(Frameworks)
SDK功能的实现，依赖了一些系统框架，在开发应用时，要在工程里加入这些框架。开发者首先点击工程右边的工程名,然后在工程名右边 依次选择TARGETS->Build Phases->Link Binary With Libraries，如果是xcode7.0以上，则将.dylib库换成.tbd库。

添加步骤:展开LinkBinary With Libraries后点击展开后下面的"+"来添加下面的依赖项,
如图所示:



υ	编译器链接设置
在xcode环境下，首先点击工程右边的工程名,然后在工程名右边依次选择TARGETS、Build Settings Linking中的Other Linker Flags. 中填入-ObjC。 如下图所示：

υ	工程属性设置
一般的iOS程序进入后台后会被系统挂起，就会停止执行，不能执行任何操作。
A.	从iOS4开始，苹果增加了特性，很好的支持了语音通话功能：
″	苹果支持应用可以在后台播放和录制声音；
″	苹果支持网络托管，保证应用在后台时，还能保持网络连接，能接收到来电；
″	应用可以设置一个超时处理，程序在后台运行时，周期性地唤醒应用，保证客户端和服务器有长连接，使网络不断开。
B.	SDK封装了这些特性，保证了在iOS平台上，有很好的语音通话体验。
C.	开发者需要修改配置文件，这样iOS工程才能支持这些特性。
在工程名的文件夹下面的Supporting Files文件夹中找到并且选择(工程名)lnfo.pList在右边出现的窗口中添加Key: Required background modes，在下面添加两个项：App plays audio和App provides Voice over IP services。(注：如果只是使用发起通话，并无接听功能，则不需要添加App provides Voice over IP services)

从iOS9开始，苹果建议所有的网络请求都要使用https，如果还想保留原有的http请求方式，开发者需要修改配置文件(注：xcode7.0以下则不需要修改)，在工程名的文件夹下面的Supporting Files文件夹中找到并且选择(工程名）lnfo.pList在右边出现的窗口中添加Key:NSAppTransportSecurity，在下面添加项：NSAllowsArbitraryLoads，设置Boolean值为YES，这样平台SDK内部工程才能支持http请求方式。

5	功能实现
本节主要介绍通过少量代码实现sdk中的语音通话能力。下面将通过代码片段介绍代码的实现过程，同时也可以选择参考Demo的代码实现。
以下步骤列出了体验语音通话能力所需要的完整代码，如果此时你已经开发好了一套语音通话的UI就可以将它们进行一个整合、编译、运行。
5.1	SDK初始化
遵循协议，实现代理方法。设置SDK的代理，首先要初始化一个UCSIPCCManager类型的对象，因为这个对象全局通用，所以实例化为单例对象。实例化与设置代理的方法为:


代理对象需要遵守的协议为：UCSIPCCDelegate
Demo 代码参考：


5.2	配置登陆信息
初始化SDK，该类提供拨打电话，接听以及拒接等方法。请再连接云平台之前初始化。

注销登陆信息

Demo代码参考:
	初始化成功回调： 


5.3	拨打电话

Demo代码参考：


5.4	接听/挂断电话



5.5	相关回调

5.6	其他功能

6	编译运行及工程打包

6.1	编译
在用Xcode打开工程后，看是需要用真机还是用模拟器运行应用，默认是模拟器下编
译运行的，单击左上角的三角符号就可以进行应用运行， 如果是真机则需要你插上真机连接电脑，然后在最上面有单击"iPhone6.1 SimuLator"(注：6.1为模拟器的版本，不同的xcode版本，模拟器的版本也会有变动)后可以看到显示你iPhone的机器名字，并且选择后点击左上角的三角符号进行运行即可(注：SDK版本暂时不支持模拟器编译)。如下图所示：

6.2	查看工程日志
查看编译器日志。
选择xcode右上角区的的按钮

6.3	工程打包
首先要从弹出的列表中选择第一项，如图：


然后选择xcode的菜单Product->Archive项，如图：


单击Export按钮，如图：



根据需要选择，测试请选择第二项，如图：


在下列窗口中请选择程序的签名证书，如图：


点击Choose后，选择第一项，确认无误后点击Next，如图：



点击Next后，核对app的信息，确认无误后点击Next，如图：


点击Next后打包结束，打包出来的.ipa文件，默认保存在桌面。

